<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vector Arrow - Orientation HUD</title>
    <style>
        :root {
            --bg: #ffffff;
            --fg: #000000;
        }
        body {
            background: var(--bg);
            color: var(--fg);
            font-family: monospace;
            margin: 0;
            padding: 10px;
            overflow: hidden;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 15px;
            color: var(--fg);
            font-weight: 900;
        }

        h1 {
            margin: 0 0 5px 0;
            font-size: 1.5rem;
        }

        .subtitle {
            margin: 0 0 15px 0;
            font-size: 0.9rem;
        }

        #hud-container {
            width: 100%;
            height: 60vh;
            min-height: 300px;
            border: 4px solid var(--fg);
            position: relative;
            touch-action: none;
            cursor: crosshair;
            overflow: hidden;
        }

        /* Crosshair guides */
        #hud-container::before,
        #hud-container::after {
            content: '';
            position: absolute;
            background: var(--fg);
            opacity: 0.3;
        }
        #hud-container::before {
            width: 2px;
            height: 100%;
            left: 50%;
            top: 0;
        }
        #hud-container::after {
            width: 100%;
            height: 2px;
            top: 50%;
            left: 0;
        }

        /* Horizon ring */
        #horizon {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200px;
            height: 200px;
            border: 4px solid var(--fg);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        /* Inner reference circle */
        #inner-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 100px;
            border: 2px solid var(--fg);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.5;
        }

        /* The arrow/vector */
        #arrow {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 8px;
            height: 120px;
            background: var(--fg);
            transform-origin: center bottom;
            transform: translate(-50%, -100%);
            transition: transform 0.05s linear;
        }

        /* Arrow head */
        #arrow::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 30px solid var(--fg);
        }

        /* Arrow base dot */
        #arrow-base {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            background: var(--fg);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        /* Shadow/projection of arrow */
        #arrow-shadow {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 6px;
            height: 80px;
            background: var(--fg);
            opacity: 0.2;
            transform-origin: center bottom;
            transform: translate(-50%, -100%) rotateX(90deg);
        }

        #stats {
            margin-top: 15px;
            padding: 15px;
            border: 4px solid var(--fg);
            font-size: 1rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .stat-row:last-child {
            margin-bottom: 0;
        }

        .stat-label {
            font-weight: 900;
        }

        #instructions {
            margin-top: 15px;
            padding: 10px;
            border: 2px dashed var(--fg);
            font-size: 0.9rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-link">&larr; Back</a>

    <h1>Orientation HUD</h1>
    <p class="subtitle">Pen tilt visualizer for calligraphy and technical drawing</p>

    <div id="hud-container">
        <div id="horizon"></div>
        <div id="inner-ring"></div>
        <div id="arrow-shadow"></div>
        <div id="arrow"></div>
        <div id="arrow-base"></div>
    </div>

    <div id="stats">
        <div class="stat-row">
            <span class="stat-label">Tilt X:</span>
            <span id="tilt-x">0°</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Tilt Y:</span>
            <span id="tilt-y">0°</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Azimuth:</span>
            <span id="azimuth">0°</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Altitude:</span>
            <span id="altitude">90°</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Pressure:</span>
            <span id="pressure">0.00</span>
        </div>
    </div>

    <div id="instructions">
        Hover or draw with your stylus to see tilt orientation
    </div>

    <script>
        const arrow = document.getElementById('arrow');
        const arrowShadow = document.getElementById('arrow-shadow');
        const container = document.getElementById('hud-container');

        const tiltXEl = document.getElementById('tilt-x');
        const tiltYEl = document.getElementById('tilt-y');
        const azimuthEl = document.getElementById('azimuth');
        const altitudeEl = document.getElementById('altitude');
        const pressureEl = document.getElementById('pressure');

        function updateArrow(e) {
            // Get tilt values (in degrees, -90 to 90)
            let tiltX = e.tiltX || 0;
            let tiltY = e.tiltY || 0;

            // Update stats display
            tiltXEl.textContent = `${tiltX.toFixed(0)}°`;
            tiltYEl.textContent = `${tiltY.toFixed(0)}°`;

            // Calculate azimuth (compass direction of tilt)
            // atan2 gives angle from positive X axis, counterclockwise
            let azimuth = Math.atan2(-tiltX, -tiltY) * (180 / Math.PI);
            if (azimuth < 0) azimuth += 360;
            azimuthEl.textContent = `${azimuth.toFixed(0)}°`;

            // Calculate altitude (how vertical the pen is)
            // 90° = vertical, 0° = horizontal
            const tiltMagnitude = Math.sqrt(tiltX * tiltX + tiltY * tiltY);
            const altitude = 90 - Math.min(tiltMagnitude, 90);
            altitudeEl.textContent = `${altitude.toFixed(0)}°`;

            // Pressure
            const pressure = e.pressure || 0;
            pressureEl.textContent = pressure.toFixed(2);

            // Transform the arrow based on tilt
            // rotateX tilts forward/back, rotateZ spins around vertical axis
            // We use tiltY for forward/back lean and tiltX for left/right lean

            // Calculate rotation angle (where arrow points)
            const rotation = Math.atan2(tiltX, -tiltY) * (180 / Math.PI);

            // Calculate lean amount (how far from vertical)
            const lean = Math.min(tiltMagnitude, 60); // Cap at 60 degrees

            // Apply 3D transform
            arrow.style.transform = `
                translate(-50%, -100%)
                rotateZ(${rotation}deg)
                rotateX(${lean}deg)
            `;

            // Shadow follows the XY projection
            const shadowLength = 80 * Math.sin(lean * Math.PI / 180);
            arrowShadow.style.height = `${Math.max(shadowLength, 10)}px`;
            arrowShadow.style.transform = `
                translate(-50%, 0)
                translateY(10px)
                rotateZ(${rotation}deg)
            `;
        }

        // Listen for pointer events on the container
        container.addEventListener('pointermove', updateArrow);
        container.addEventListener('pointerdown', updateArrow);

        // Also listen globally for hover detection
        document.addEventListener('pointermove', (e) => {
            // Only process if it's a pen/stylus with tilt data
            if (e.pointerType === 'pen' || e.tiltX !== 0 || e.tiltY !== 0) {
                updateArrow(e);
            }
        });

        // Reset on pointer leave
        container.addEventListener('pointerleave', () => {
            arrow.style.transform = 'translate(-50%, -100%)';
            arrowShadow.style.transform = 'translate(-50%, 0) translateY(10px)';
            arrowShadow.style.height = '10px';
        });
    </script>
</body>
</html>
