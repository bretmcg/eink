<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stylus Drawing Test</title>
    <style>
        :root {
            --bg: #ffffff;
            --fg: #000000;
        }
        body {
            background: var(--bg);
            color: var(--fg);
            font-family: monospace;
            margin: 0;
            padding: 10px;
            overflow: hidden;
        }

        .panel { border: 4px solid var(--fg); padding: 15px; }

        button {
            background: var(--bg);
            border: 4px solid var(--fg);
            padding: 15px 25px;
            font-size: 1.2rem;
            font-weight: 900;
            margin-right: 10px;
            cursor: pointer;
        }
        button:active { background: var(--fg); color: var(--bg); }

        #draw-canvas {
            width: 100%;
            height: 400px;
            border: 2px solid var(--fg);
            touch-action: none;
            cursor: crosshair;
        }

        #draw-stats {
            margin-top: 10px;
            font-size: 1rem;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 15px;
            color: var(--fg);
            font-weight: 900;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">&larr; Back</a>

    <div class="panel">
        <h1>Stylus Drawing Test</h1>
        <canvas id="draw-canvas"></canvas>
        <div style="margin-top:10px;">
            <button onclick="clearCanvas()">Clear</button>
            <button onclick="togglePressure()">Pressure: ON</button>
        </div>
        <div id="draw-stats">
            Points/sec: <span id="pps">0</span> |
            Pressure: <span id="pressure">N/A</span> |
            Total points: <span id="total-points">0</span>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('draw-canvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let usePressure = true;
        let totalPoints = 0;
        let lastPointTime = performance.now();
        let pointsThisSecond = 0;

        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        canvas.addEventListener('pointerdown', (e) => {
            isDrawing = true;
            ctx.beginPath();
            ctx.moveTo(e.offsetX, e.offsetY);
            e.preventDefault();
        });

        canvas.addEventListener('pointermove', (e) => {
            if (!isDrawing) return;

            pointsThisSecond++;
            totalPoints++;
            const now = performance.now();
            if (now - lastPointTime >= 1000) {
                document.getElementById('pps').textContent = pointsThisSecond;
                pointsThisSecond = 0;
                lastPointTime = now;
            }
            document.getElementById('total-points').textContent = totalPoints;

            const pressure = e.pressure || 0.5;
            document.getElementById('pressure').textContent = pressure.toFixed(2);

            const baseWidth = 3;
            ctx.lineWidth = usePressure ? baseWidth + (pressure * 8) : baseWidth;

            const fg = getComputedStyle(document.documentElement).getPropertyValue('--fg').trim();
            ctx.strokeStyle = fg;

            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(e.offsetX, e.offsetY);

            e.preventDefault();
        });

        canvas.addEventListener('pointerup', () => { isDrawing = false; });
        canvas.addEventListener('pointerleave', () => { isDrawing = false; });

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            totalPoints = 0;
            document.getElementById('total-points').textContent = 0;
        }

        function togglePressure() {
            usePressure = !usePressure;
            event.target.textContent = `Pressure: ${usePressure ? 'ON' : 'OFF'}`;
        }
    </script>
</body>
</html>
