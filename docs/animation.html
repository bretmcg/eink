<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animation Test</title>
    <style>
        :root {
            --bg: #ffffff;
            --fg: #000000;
        }
        body {
            background: var(--bg);
            color: var(--fg);
            font-family: monospace;
            margin: 0;
            padding: 10px;
            overflow: hidden;
        }

        .panel { border: 4px solid var(--fg); padding: 15px; }

        button {
            background: var(--bg);
            border: 4px solid var(--fg);
            padding: 15px 25px;
            font-size: 1.2rem;
            font-weight: 900;
            margin-right: 10px;
            cursor: pointer;
        }
        button:active { background: var(--fg); color: var(--bg); }

        #stage {
            width: 100%;
            height: 250px;
            border: 2px solid var(--fg);
            position: relative;
            margin-bottom: 10px;
        }

        #box {
            width: 80px;
            height: 80px;
            background: var(--fg);
            position: absolute;
            top: 85px;
            left: 0;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 15px;
            color: var(--fg);
            font-weight: 900;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">&larr; Back</a>

    <div class="panel">
        <h1>E-Ink Animation Test</h1>
        <div id="stage"><div id="box"></div></div>
        <div style="margin-top:10px;">
            <button onclick="toggleAnim()">Start/Stop</button>
            <button onclick="invert()">Invert UI</button>
        </div>
        <p id="fps">FPS: 0</p>
    </div>

    <script>
        let pos = 0;
        let speed = 20;
        let dir = 1;
        let active = false;
        const box = document.getElementById('box');
        const fpsLabel = document.getElementById('fps');
        let frames = 0;
        let lastTime = performance.now();

        function loop(time) {
            if (!active) return;

            frames++;
            if (time - lastTime >= 1000) {
                fpsLabel.innerText = `FPS: ${frames}`;
                frames = 0;
                lastTime = time;
            }

            const maxW = document.getElementById('stage').clientWidth - 80;
            pos += speed * dir;
            if (pos > maxW || pos < 0) dir *= -1;
            box.style.transform = `translateX(${pos}px)`;

            requestAnimationFrame(loop);
        }

        function toggleAnim() {
            active = !active;
            if (active) requestAnimationFrame(loop);
        }

        function invert() {
            const root = document.documentElement;
            const currentBg = getComputedStyle(root).getPropertyValue('--bg').trim();
            if (currentBg === '#ffffff') {
                root.style.setProperty('--bg', '#000000');
                root.style.setProperty('--fg', '#ffffff');
            } else {
                root.style.setProperty('--bg', '#ffffff');
                root.style.setProperty('--fg', '#000000');
            }
        }
    </script>
</body>
</html>
